# Feature Specification: 駒クリック時の選択ハイライト表示

**Feature Branch**: `013-piece-click-highlight`
**Created**: 2025年12月14日
**Status**: Draft
**Input**: User description: "盤上の駒を動かすとき、動かす駒をクリックしたときだけマス目に枠が表示されてほしい。動かす駒のないマス目をクリックしても枠がでないでほしい。枠の色は黒でないオレンジか茶色っぽい色にしたい。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 駒選択時の視覚的フィードバック (Priority: P1)

ユーザーが盤上で駒を移動させるとき、どの駒が選択されているかを明確に把握できる必要がある。駒をクリックすると、そのマス目に目立つ枠が表示され、選択状態が視覚的に確認できる。

**Why this priority**: これは駒移動操作の基本的なUXであり、ユーザーが現在どの駒を操作しているかを理解するための必須機能。視覚的フィードバックがないと、ユーザーは自分の操作が受け付けられたか判断できない。

**Independent Test**: 盤上の任意の駒をクリックし、そのマス目に枠が表示されることで単独でテスト可能。この機能だけで「駒選択の視覚的確認」という価値を提供できる。

**Acceptance Scenarios**:

1. **Given** 将棋盤が初期配置で表示されている、**When** ユーザーが駒が配置されているマス目をクリックする、**Then** クリックされたマス目にオレンジ色または茶色系の枠が表示される
2. **Given** ある駒が既に選択されている（枠が表示されている）、**When** ユーザーが別の駒をクリックする、**Then** 前の駒の枠が消え、新しくクリックされた駒のマス目に枠が表示される
3. **Given** 将棋盤が表示されている、**When** ユーザーが駒を移動先のマス目に配置する、**Then** 移動完了後、選択枠が消える

---

### User Story 2 - 空マスクリック時の無反応 (Priority: P1)

ユーザーが誤って駒のない空のマス目をクリックした場合、何も起こらない。これにより、ユーザーは「駒がある場所だけが選択可能」というルールを直感的に理解できる。

**Why this priority**: P1と同じく基本的なUX原則。不要な視覚的フィードバックを防ぎ、ユーザーが操作の意図と結果を正しく理解できるようにする。これがないと、空マスをクリックしても枠が出てしまい混乱を招く。

**Independent Test**: 空のマス目をクリックして何も起こらないことを確認するだけで単独テスト可能。

**Acceptance Scenarios**:

1. **Given** 将棋盤が表示されている、**When** ユーザーが駒が配置されていない空のマス目をクリックする、**Then** 枠は表示されず、何も選択されない
2. **Given** 将棋盤が表示されている、**When** ユーザーが複数の空マスを連続してクリックする、**Then** いずれのマス目にも枠は表示されない

---

### User Story 3 - 視認性の高い枠色の使用 (Priority: P2)

選択枠の色がオレンジ系または茶色系であることで、従来の黒い枠よりも視認性が高く、将棋盤や駒のデザインと調和しながらも明確に区別できる。

**Why this priority**: 視覚的な品質改善であり、P1機能が動作すれば最小限の価値は提供できるが、ユーザー体験を大きく向上させる重要な要素。

**Independent Test**: 駒を選択したときの枠色を目視で確認し、オレンジまたは茶色系であることを検証するだけで単独テスト可能。

**Acceptance Scenarios**:

1. **Given** 将棋盤が表示されている、**When** ユーザーが駒をクリックして選択する、**Then** 表示される枠の色はオレンジ系または茶色系（#EA580C、#C2410C、#92400E、または類似色）である
2. **Given** 駒が選択されて枠が表示されている、**When** ユーザーが視覚的に枠を確認する、**Then** 枠は盤面や駒のデザインから明確に区別でき、黒色ではない

---

### User Story 4 - 手番による駒選択制限 (Priority: P1)

ユーザーは自分の手番のときにのみ、自分の駒を選択できる。相手の駒や、相手の手番中に自分の駒をクリックしても、枠は表示されない。これにより、ユーザーは「今動かせる駒」が明確に理解できる。

**Why this priority**: 将棋の基本ルールであり、ユーザーが誤操作を防ぐための必須機能。これがないと、動かせない駒を選択しようとして混乱を招く。

**Independent Test**: 先手の番で後手の駒をクリックし、枠が表示されないことを確認するだけで単独テスト可能。

**Acceptance Scenarios**:

1. **Given** 先手の手番である、**When** ユーザーが先手の駒をクリックする、**Then** 枠が表示される
2. **Given** 先手の手番である、**When** ユーザーが後手の駒をクリックする、**Then** 枠は表示されず、何も選択されない
3. **Given** 後手の手番である、**When** ユーザーが先手の駒をクリックする、**Then** 枠は表示されず、何も選択されない
4. **Given** 後手の手番である、**When** ユーザーが後手の駒をクリックする、**Then** 枠が表示される

---

### Edge Cases

- 持ち駒をクリックした場合はどうするか？→ この機能は盤上の駒のみを対象とする。持ち駒の選択は別の機能で扱う（現在の仕様では持ち駒クリック時の動作は変更しない）
- 選択後、駒を移動せずに同じ駒を再度クリックした場合は？→ 選択が解除され、枠が消える（トグル動作）
- 手番が切り替わったとき、既に選択されている駒の枠はどうなるか？→ 手番が切り替わった時点で、選択状態は自動的に解除され、枠が消える

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは、ユーザーが現在の手番のプレイヤーが所有する駒が配置されているマス目をクリックしたとき、そのマス目に視覚的な選択枠を表示しなければならない
- **FR-002**: システムは、ユーザーが駒が配置されていない空のマス目をクリックしたとき、選択枠を表示してはならない
- **FR-003**: システムは、ユーザーが相手のプレイヤーが所有する駒（現在の手番でない側の駒）をクリックしたとき、選択枠を表示してはならない
- **FR-004**: システムは、選択枠の色としてオレンジ系（#EA580C推奨）または茶色系（#C2410C、#92400E推奨）を使用しなければならず、黒色を使用してはならない
- **FR-005**: システムは、新しい駒が選択されたとき、以前に選択されていた駒の選択枠を自動的に解除しなければならない
- **FR-006**: システムは、選択された駒が移動完了後、選択枠を自動的に解除しなければならない
- **FR-007**: システムは、既に選択されている駒を再度クリックしたとき、選択を解除し枠を消さなければならない
- **FR-008**: システムは、手番が切り替わったとき、既存の選択状態を自動的に解除しなければならない

### Key Entities

- **選択状態**: 現在ユーザーが選択している駒の位置情報（行、列）。null の場合は何も選択されていない状態を表す
- **マス目**: 将棋盤上の各セル。駒の有無、選択状態、座標情報を持つ

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーが駒をクリックしてから選択枠が表示されるまでの時間が100ミリ秒以内である
- **SC-002**: ユーザーの90%以上が「どの駒が選択されているか明確に分かる」と評価する
- **SC-003**: 空マスをクリックしたときに誤って枠が表示されるエラーが0件である
- **SC-004**: 相手の駒をクリックしたときに誤って枠が表示されるエラーが0件である
- **SC-005**: 選択枠の色が仕様で定められた色範囲（オレンジ系または茶色系）内にあり、黒色でないことが視覚的に検証可能である

## Scope *(mandatory)*

### In Scope

- 盤上の駒をクリックしたときの選択枠の表示
- 空マスクリック時に枠を表示しない制御
- 選択枠の色をオレンジ系または茶色系に変更
- 選択枠の表示・非表示のトグル動作
- 駒移動完了時の選択枠の自動解除

### Out of Scope

- 持ち駒をクリックしたときの視覚的フィードバック（別機能で扱う）
- 手番による駒選択の可否判定（既存機能で実装済み）
- 移動可能なマス目のハイライト表示（既存機能または別機能で扱う）
- 選択枠のアニメーション効果
- 複数の駒を同時に選択する機能

## Assumptions *(mandatory)*

- 既存のコードには駒のクリックイベントハンドラーが実装されている
- マス目には駒の有無を判定できるデータ構造が存在する
- 駒にはプレイヤー所有者情報（先手/後手）が含まれている
- 現在の手番を示すステート（先手/後手）が存在し、アクセス可能である
- 現在の選択状態を管理するステート管理機構が存在する
- CSS またはスタイリングシステムで枠の色を変更可能である
- 駒の移動機能は既に実装されており、移動完了を検知できる

## Dependencies *(mandatory)*

- 既存の駒移動機能（003-piece-movement または類似機能）
- 既存の手番管理機能（004-turn-based-movement または類似機能）
- 既存の盤面レンダリング機能（002-shogi-board-display または類似機能）
- ステート管理システム（React の useState など）
- スタイリングシステム（Tailwind CSS など）

## Non-Functional Requirements *(mandatory)*

- **パフォーマンス**: 駒クリックから選択枠表示までの応答時間は100ミリ秒以内
- **視認性**: 選択枠は盤面や駒から明確に視覚的に区別できる色とサイズを持つ
- **一貫性**: すべてのマス目で選択枠の表示スタイルが統一されている
- **アクセシビリティ**: 色覚特性を持つユーザーでも選択枠が識別できる色コントラストを確保する

## Future Considerations *(optional)*

- 選択枠のアニメーション効果（フェードイン・フェードアウト）
- 移動可能なマス目を同時にハイライト表示する機能との連携
- 持ち駒選択時の視覚的フィードバックの統一
- ユーザーが枠の色をカスタマイズできる設定機能
- タッチデバイスでの長押しによる選択など、代替操作方法のサポート
