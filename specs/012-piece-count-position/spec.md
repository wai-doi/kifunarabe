# Feature Specification: 持ち駒の数字表示位置変更

**Feature Branch**: `012-piece-count-position`
**Created**: 2025-12-13
**Status**: Draft
**Input**: User description: "同じ種類の持ち駒を複数持っているときの数字の表示を変えたい。駒の文字に数字があるのでなく、持ち駒の右の下側に数字があるようにしたい。"

<!-- 注意: このテンプレートから生成される仕様書は、憲法に従い日本語で記述してください -->

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 持ち駒の数字を駒の右下に配置 (Priority: P1)

将棋を指すユーザーとして、同じ種類の持ち駒を複数持っている場合に、その数字が駒の文字と一緒ではなく、駒の右下に小さく表示されることで、駒の文字が見やすく、かつ枚数も一目で分かるようにしたい。

**Why this priority**: 駒の文字と数字が同じ行に並んでいると、駒の文字が読みにくくなり、特に小さい持ち駒エリアでは視認性が低下します。右下に配置することで、本物の将棋盤で駒を重ねて置く際の視覚的な感覚に近づき、駒の種類の識別と枚数の確認を両立できます。

**Independent Test**: 複数の同じ種類の持ち駒を持った状態で持ち駒エリアを表示し、数字が駒の文字の右下に配置されているかを視覚的に確認することで、独立してテスト可能です。この機能単体で価値を提供します。

**Acceptance Scenarios**:

1. **Given** 先手が歩を2枚持っている状態で、**When** 持ち駒エリアを見たとき、**Then** 「歩」という文字が駒の中央に表示され、その右下に「2」という数字が表示されている
2. **Given** 先手が飛車を1枚だけ持っている状態で、**When** 持ち駒エリアを見たとき、**Then** 「飛」という文字のみが表示され、数字は表示されていない
3. **Given** 後手が桂馬を3枚持っている状態で、**When** 持ち駒エリアを見たとき、**Then** 「桂」という文字が駒の中央に表示され、その右下に「3」という数字が表示されている
4. **Given** 先手が角を5枚持っている状態で、**When** 持ち駒エリアを見たとき、**Then** 「角」という文字が駒の中央に表示され、その右下に「5」という数字が表示されている（2桁でも適切に表示）

---

### User Story 2 - 数字のサイズと色の視認性 (Priority: P2)

将棋を指すユーザーとして、右下に表示される数字が駒の文字よりも小さく、かつ適切な色で表示されることで、駒の種類と枚数を瞬時に区別して認識したい。

**Why this priority**: 数字が駒の文字と同じサイズや色だと、視覚的な階層が不明確になり、どちらが主要な情報か分かりにくくなります。数字を小さくし、適切な色で表示することで、駒の種類が主要情報で、枚数が補助情報であることが明確になります。

**Independent Test**: 複数の同じ種類の持ち駒を持った状態で、数字のサイズが駒の文字より小さく、かつ視認可能な色で表示されているかを確認することで独立してテスト可能です。

**Acceptance Scenarios**:

1. **Given** 持ち駒に複数枚の駒がある状態で、**When** 数字のサイズを駒の文字と比較したとき、**Then** 数字のフォントサイズが駒の文字よりも明らかに小さい（約50-70%程度）
2. **Given** 持ち駒に複数枚の駒がある状態で、**When** 数字の色を確認したとき、**Then** 数字は木目調の背景に対して十分なコントラストがあり、読みやすい色（濃い茶色やダークグレーなど）で表示されている
3. **Given** 成り駒を複数枚持っている状態で、**When** 駒と数字を見たとき、**Then** 駒の文字は赤色、数字は濃い茶色やダークグレーで表示され、両者が視覚的に区別できる

---

### User Story 3 - 選択状態での数字の可視性 (Priority: P3)

将棋を指すユーザーとして、持ち駒を選択した状態でも数字が見えることで、打とうとしている駒の残り枚数を常に把握したい。

**Why this priority**: 持ち駒を選択してハイライトされた状態でも、枚数が分からないと、その駒を打った後に残りが何枚あるかが不明確になります。選択状態でも数字が可視であることで、より確実な戦略的判断が可能になります。

**Independent Test**: 複数枚の持ち駒を選択した状態で、数字が適切に表示され、ハイライトと干渉していないかを確認することで独立してテスト可能です。

**Acceptance Scenarios**:

1. **Given** 歩を3枚持っている状態で、**When** 持ち駒の歩を選択したとき、**Then** ハイライトが表示されるが、右下の「3」という数字は引き続き見える
2. **Given** 複数の持ち駒を持っている状態で、**When** いずれかの駒を選択したとき、**Then** 選択による背景色の変化が数字の可読性を妨げない

---

### Edge Cases

- 持ち駒が10枚以上（2桁）の場合でも、数字が駒の右下に収まるか？
- 駒のサイズが小さい場合（モバイルデバイスなど）でも、数字が判読可能か？
- 五角形の駒の形状内で、右下に数字を配置するスペースが確保されているか？
- 後手の駒（180度回転）の場合でも、数字が常に画面上の物理的な右下に配置され、視覚的に統一感があるか？
- 成り駒（赤色の文字）の場合、数字の色は濃い茶色やダークグレーで表示され、駒の文字と区別できるか？
- 数字が駒の枠線や陰影と重なった場合でも、判読可能か？

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは、同じ種類の持ち駒を2枚以上持っている場合、その枚数を数字で表示しなければならない
- **FR-002**: 枚数を示す数字は、駒の文字の右下に配置されなければならない
- **FR-003**: 持ち駒が1枚のみの場合、数字は表示されてはならない
- **FR-004**: 数字のフォントサイズは、駒の文字のフォントサイズよりも小さくなければならない（推奨: 駒の文字の50-70%程度）
- **FR-005**: 数字の色は、木目調の背景に対して十分なコントラストがあり、読みやすい色でなければならない
- **FR-006**: 成り駒の場合、駒の文字は赤色で表示されるが、数字の色は通常の駒と同じ色（濃い茶色やダークグレーなど）でなければならない
- **FR-007**: 駒が選択された状態でも、数字は可読性を維持して表示されなければならない
- **FR-008**: 2桁以上の数字（10枚以上）でも、駒の右下に適切に配置され、判読可能でなければならない
- **FR-009**: 数字は駒の五角形の形状内に収まり、枠線や陰影と重ならない位置に配置されなければならない
- **FR-010**: 後手の駒（180度回転）の場合でも、数字は常に画面上の物理的な右下に配置されなければならない（駒の回転に関係なく、先手・後手で数字の配置位置を統一する）

### Key Entities

- **持ち駒の数字表示**: 持ち駒エリアに表示される、同じ種類の駒の枚数を示す数値
  - 表示条件: 同じ種類の駒が2枚以上ある場合のみ表示
  - 配置位置: 駒の文字の右下
  - サイズ: 駒の文字より小さい（推奨: 駒の文字の50-70%）
  - 色: 木目調の背景に対してコントラストが高い色（濃い茶色、ダークグレーなど）
  - 範囲: 1桁から2桁以上（理論上は最大18枚）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 持ち駒を2枚以上持っている場合、100%のケースで数字が駒の右下に表示される
- **SC-002**: 数字のフォントサイズが駒の文字のフォントサイズの50-70%であり、視覚的に明確な階層が形成される
- **SC-003**: ユーザーテストにおいて、90%以上のユーザーが持ち駒の枚数を3秒以内に正確に読み取れる
- **SC-004**: 持ち駒が1枚のみの場合、数字が表示されないことが100%のケースで確認される
- **SC-005**: 駒が選択された状態でも、数字の可読性が維持され、ユーザーテストで90%以上のユーザーが数字を読み取れる
- **SC-006**: 2桁の数字（10枚以上）でも、駒の右下に適切に配置され、判読可能であることが100%のケースで確認される

## Assumptions *(mandatory)*

- 持ち駒エリアのデザインは五角形の駒の形状を採用しており、その形状内に数字を配置する十分なスペースがある
- 現在の実装では `×{count}` という形式で数字が駒の文字と同じ行に表示されているが、これを右下に配置する変更が可能である
- 数字の配置位置は絶対配置または相対配置を用いて実現できる
- 後手の駒は180度回転して表示されるが、数字は常に画面上の物理的な右下に配置されるため、先手・後手で数字の配置ロジックを共通化できる
- 木目調の背景色は既に実装されており、その背景に対して数字の色を選択できる
- モバイルデバイスでの表示も考慮されており、小さい画面でも数字が判読可能なサイズを確保できる

## Non-functional Requirements *(optional)*

### Performance

- 持ち駒の枚数表示の更新は、駒を取ったり打ったりする操作の直後に即座に反映される（50ms以内）
- 数字の表示・非表示の切り替え（枚数が1枚と2枚の境界）は、視覚的に滑らかに行われる

### Usability

- 数字の配置位置とサイズは、ユーザーが駒の種類と枚数を瞬時に識別できるように最適化される
- 色のコントラストは、アクセシビリティ基準（WCAG 2.1 AA）を満たす

### Compatibility

- 数字の表示は、異なるブラウザ（Chrome, Firefox, Safari, Edge）で一貫性を持つ
- モバイルデバイス（iOS, Android）でも、数字が適切に表示され、判読可能である

## Dependencies *(optional)*

- **011-realistic-piece-design**: 五角形の駒の形状と木目調の背景が実装されていることが前提
- **006-piece-drop**: 持ち駒の取得と打つ機能が実装されていることが前提
- 現在の `CapturedPieces.tsx` コンポーネントの実装に依存

## Out of Scope *(optional)*

- 盤面上の駒の表示の変更（この機能は持ち駒エリアのみが対象）
- 持ち駒の並び順の変更（現在の標準的な順序を維持）
- 持ち駒エリア全体のレイアウトの大幅な変更（数字の配置位置のみを変更）
- アニメーション効果（数字の表示・非表示時のフェードインなど）
- 数字の表示形式の変更（「×2」から「2」への変更は含むが、その他の形式は対象外）
- ユーザーによる数字の表示/非表示の切り替え機能（常に表示される）

## Related Features *(optional)*

- **011-realistic-piece-design**: 五角形の駒の形状と木目調の背景
- **006-piece-drop**: 持ち駒を打つ機能
- **005-piece-capture**: 駒を取って持ち駒にする機能
- **002-shogi-board-display**: 将棋盤と駒の基本的な表示

## Risks & Considerations *(optional)*

- **視認性のリスク**: 数字を小さくしすぎると、特にモバイルデバイスで判読が困難になる可能性がある
  - 対策: 適切なフォントサイズ（駒の文字の50-70%）を維持し、ユーザーテストで検証する

- **レイアウトの複雑化**: 五角形の駒の形状内で右下に数字を配置するため、レイアウトロジックが複雑になる可能性がある
  - 対策: 絶対配置や相対配置を用いて、シンプルで保守性の高い実装を心がける

- **後手の駒の回転**: 後手の駒は180度回転するが、数字は常に画面上の物理的な右下に配置することで、先手・後手の視覚的な統一感を維持する
  - 対策: 数字の配置は駒の回転に影響されず、常に画面上の右下に固定する実装を行う

- **アクセシビリティ**: 数字が小さくなることで、視覚障害を持つユーザーにとって読みにくくなる可能性がある
  - 対策: 十分なコントラストを確保し、必要に応じて拡大機能をサポートする（将来の改善）
